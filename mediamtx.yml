# mediamtx.yml - Railway Optimized with RTMP Focus
logLevel: info
logDestinations: [stdout]
readTimeout: 10s
writeTimeout: 10s

# API
api: yes
apiAddress: :9997
apiAllowOrigin: '*'

# ✅ FOCUS on HLS (Most reliable on Railway)
hls: yes
hlsAddress: :8888
hlsAllowOrigin: '*'
hlsAlwaysRemux: yes
hlsVariant: mpegts
hlsSegmentCount: 10
hlsSegmentDuration: 2s
hlsPartDuration: 200ms
hlsSegmentMaxSize: 50M

# ✅ RTMP (Alternative to WebRTC for Railway)
rtmp: yes
rtmpAddress: :1935
rtmpEncryption: "no"

# ✅ SRT (Better for Railway than WebRTC)
srt: yes
srtAddress: :8890

# ✅ Simplified WebRTC (Backup only)
webrtc: yes
webrtcAddress: :8889
webrtcAllowOrigin: '*'
webrtcLocalUDPAddress: :8189
webrtcLocalTCPAddress: :8190
webrtcIPsFromInterfaces: no
webrtcAdditionalHosts: ["0.0.0.0"]
webrtcICEServers2:
  - url: stun:stun.l.google.com:19302
webrtcHandshakeTimeout: 5s  # Shorter timeout
webrtcTrackGatherTimeout: 2s

# ✅ RTSP with TCP (Railway friendly)
rtsp: yes
rtspAddress: :8554
rtspTransports: [tcp]

# ✅ Critical path settings
pathDefaults:
  source: publisher
  sourceOnDemand: no
  overridePublisher: yes
  runOnInit: 'echo "Path $MTX_PATH initialized"'
  runOnInitRestart: yes

paths:
  all_others:
    source: publisher
    runOnReady: 'echo "Stream $MTX_PATH ready for HLS"'
    runOnReadyRestart: yes
