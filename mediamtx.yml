# mediamtx.yml - Railway Compatible
###############################################
# Global settings
###############################################
logLevel: info
logDestinations: [stdout]
readTimeout: 10s
writeTimeout: 10s
writeQueueSize: 512

###############################################
# Authentication - Enable for Railway
###############################################
authMethod: internal
authInternalUsers:
  - user: any
    pass:
    ips: []
    permissions:
    - action: publish
      path:
    - action: read
      path:
    - action: playback
      path:
  - user: any
    pass:
    ips: ['127.0.0.1', '::1']
    permissions:
    - action: api
    - action: metrics
    - action: pprof

###############################################
# Control API - ENABLE for Railway
###############################################
api: yes  # ✅ Changed from 'no' to 'yes'
apiAddress: :9997
apiAllowOrigin: '*'

###############################################
# RTSP server - Keep enabled
###############################################
rtsp: yes
rtspAddress: :8554
rtspTransports: [tcp]  # ✅ Only TCP for Railway compatibility

###############################################
# RTMP server - Keep enabled
###############################################
rtmp: yes
rtmpAddress: :1935

###############################################
# HLS server - CRITICAL for Railway
###############################################
hls: yes
hlsAddress: :8888
hlsAllowOrigin: '*'
hlsAlwaysRemux: yes  # ✅ Changed to 'yes' for instant streaming
hlsVariant: mpegts   # ✅ Changed from 'lowLatency' to 'mpegts' for Railway
hlsSegmentCount: 3   # ✅ Reduced for Railway memory
hlsSegmentDuration: 1s
hlsPartDuration: 200ms

###############################################
# WebRTC server - MAIN CONFIG for Railway
###############################################
webrtc: yes
webrtcAddress: :8889
webrtcAllowOrigin: '*'
webrtcLocalUDPAddress: :8189
webrtcLocalTCPAddress: :8190  # ✅ Enable TCP fallback for Railway
webrtcIPsFromInterfaces: no   # ✅ Disable for Railway
webrtcAdditionalHosts: []     # ✅ Railway will auto-configure
# ✅ Add STUN servers for Railway
webrtcICEServers2:
  - url: stun:stun.l.google.com:19302
  - url: stun:stun1.l.google.com:19302
webrtcHandshakeTimeout: 10s
webrtcTrackGatherTimeout: 2s

###############################################
# SRT server
###############################################
srt: yes
srtAddress: :8890

###############################################
# Path settings - Simplified for Railway
###############################################
pathDefaults:
  source: publisher
  sourceOnDemand: no
  maxReaders: 0
  record: no
  overridePublisher: yes

paths:
  all_others:
